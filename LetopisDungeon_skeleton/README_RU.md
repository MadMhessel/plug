# LetopisDungeon — кооперативный данж (Paper 1.21.11)

LetopisDungeon — самодостаточный плагин для Paper 1.21.11 (Java 21), который запускает кооперативный данж в отдельном мире.
Сессия проходит через пять комнат: подготовка, волны, головоломка, волны, финальный босс.
Комнаты генерируются по теме (катакомбы, бастион, ледяная гробница и т.д.) с разной геометрией, освещением и декором.

## Сборка
1) Установите Java 21.
2) Запустите `tools\windows\build_plugin.bat` — скрипт скачает Gradle 8.10.2 и соберёт плагин.
3) Скопируйте `build/libs/LetopisDungeon-0.2.0.jar` в `plugins/`.
4) Запустите Paper 1.21.11.

## Проверка JAR
Проверьте, что в архиве есть `plugin.yml`:
`jar tf build/libs/*.jar`
Убедитесь, что среди файлов присутствует `plugin.yml`.

## Команды
- `/letodungeon help` — справка.
- `/letodungeon guide` — выдать книгу-инструкцию.
- `/letodungeon start` — запуск режима 50/50 (вход через обычный мир или прямой телепорт).
- `/letodungeon start overworld` — принудительный вход через обычный мир.
- `/letodungeon start dimension` — принудительный запуск в мир данжа.
- `/letodungeon join` — присоединиться к текущей сессии.
- `/letodungeon leave` — покинуть данж.
- `/letodungeon status` — состояние сессии.
- `/letodungeon stop` — остановить сессию (админ).
- `/letodungeon debug room <prep|waves1|puzzle|waves2|boss>` — переключить комнату (отладка).
- `/letodungeon debug wave` — перезапустить волны (отладка).
- `/letodungeon debug boss` — перезапустить босса (отладка).

## Как проходит забег
- Входная структура в обычном мире исчезает после входа в данж.
- Проходы между комнатами закрываются позади команды, нельзя вернуться назад.
- Если все участники выбыли или вышли, сессия завершается как вайп: UI очищается, игроки возвращаются в безопасную точку, регион данжа чистится.
- Блоки внутри региона нельзя ломать/ставить, телепорты наружу блокируются.

## Права
- `letodungeon.use` — запуск сессии.
- `letodungeon.admin` — остановка сессии.
- `letodungeon.debug` — отладочные команды и строительство в мире данжа.

## Конфигурация
Файл `config.yml`:
- `dungeon.worldName` — имя мира данжа.
- `dungeon.rules.*` — правила мира (ломание блоков, случайные тики).
- `dungeon.session.*` — лимит времени, размеры области, шаг сетки.
- `dungeon.session.respawn.returnToLobby` — возвращать ли игрока после смерти в безопасную точку (по умолчанию — нет, игрок считается выбывшим).
- `dungeon.rooms.*` — размеры комнат и коридоров.
- `dungeon.lights.*` — лимит света в комнате, плотность и стиль мрака.
- `dungeon.decor.density` — плотность декора (0–1).
- `dungeon.themes.*` — включённые темы и их веса для случайного выбора.
- `dungeon.waves.*` — параметры волн.
- `dungeon.puzzle.*` — параметры головоломки.
- `dungeon.boss.*` — параметры босса.
- `rewards.*` — таблица наград (веса, шансы, имена и лор).
- `ui.*` — интерфейс (BossBar, ActionBar).

Файл `messages_ru.yml` содержит все тексты для игроков.

## Быстрый тест (5 минут)
1) Запустите сервер и убедитесь, что плагин загрузился.
2) В игре выполните `/letodungeon start`.
3) Войдите через появившийся вход или автоматически окажитесь в данже.
4) Пройдите волны, решите головоломку, победите босса.
5) Убедитесь, что участники вернулись обратно и получили награды.

## Скрипты для Windows
- `tools\windows\build_plugin.bat` — сборка и копирование в папку `MC_PLUGINS_DIR`.
- `tools\windows\run_test_server.bat` — запуск тестового сервера в `test_server`.
