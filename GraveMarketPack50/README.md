# GraveMarket (v0.5.0) — «могилы» для мини‑сервера

Это **рабочий каркас + ядро механики** по вашему ТЗ (примерно 50% функционала).  
Собирается Maven Wrapper'ом и рассчитан на Paper/Spigot API **1.21.x**.

## Что уже сделано (реально работает)

- Смерть игрока → лут **не разбрасывается**, а сохраняется в могиле:
  - **физическая могила** (бочка/сундук) в безопасной точке рядом со смертью;
  - если место опасное (лава/вода/пустота/не нашлось безопасно) → **виртуальная могила** (лут в учёте плагина).
- Поиск безопасной позиции в радиусе (`graves.safeSearchRadius`).
- Ограничение: **макс. 1 активная могила на игрока** (старую схлопывает в виртуальную, чтобы не абьюзили).
- Таймер жизни могилы (`graves.lifetimeSeconds`), после истечения — схлопывание в виртуальную и удаление после ретенции.
- Доступ:
  - владелец + доверенные (`/grave trust`, `/grave untrust`, `/grave trustlist`)
  - защита от ломания/взрывов (ломать может только `gravemarket.admin`)
- Анти‑абьюз «могила ≠ склад»:
  - запрещено **класть предметы** в могильный контейнер (вставка/shift‑вставка/drag блокируются)
- ПВП‑правило:
  - если смерть от игрока — **часть предметов** падает обычным образом (`pvp.partialDropChance`)
  - стоимость извлечения выше (`pvp.extractCostMultiplier`)
- Экономика:
  - попытка использовать общую экономику **TeleportMarket** (через рефлексию)
  - если не найден/несовместим — внутренний запас кредитов (`gravemarket-economy.yml`)
- Платные услуги:
  - `extract` — открыть доступ к вещам (**/grave pay**)
  - `compass` — компас на могилу (**/grave compass**)
  - `beacon` — временный луч частиц (**/grave beacon**)
  - `recall` — вернуть вещи к себе (**/grave recall**) + кулдаун
  - `tp` — телепорт к могиле (**/grave tp**)

## Что ещё не сделано (запланировано на следующую итерацию)

- «Режим выдачи владельцу» для доверенных (пока доверенный просто может забрать).
- Более умная логика «алтаря» (сейчас только скидка на recall рядом с точкой).
- Более точные логи «кто что взял» (сейчас есть общий аудит + можно расширить до по‑предметного).
- Страховка (подписка на сутки/неделю).
- Интерактивные кнопки/подсказки в стиле «маршрут/путь» (есть кликабельные команды после смерти, но без «построения пути»).

## Сборка

Windows (PowerShell):
```powershell
cd GraveMarketPack50
.\mvnw.cmd -DskipTests package
```

Linux/macOS:
```bash
cd GraveMarketPack50
chmod +x mvnw
./mvnw -DskipTests package
```

Готовый JAR появится в `target/`.

## Установка

1. Скопируйте JAR в `plugins/`.
2. (Опционально) Поставьте TeleportMarket, чтобы экономика была общей.
3. Перезапустите сервер.
4. Настройте `config.yml`.

## Команды

- `/grave info`
- `/grave pay`
- `/grave compass`
- `/grave beacon`
- `/grave recall`
- `/grave tp`
- `/grave trust <ник>`
- `/grave untrust <ник>`
- `/grave trustlist`
- Админ: `/graveadmin help`

